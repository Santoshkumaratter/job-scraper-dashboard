{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load static %}

{% block title %}{% if form.instance.pk %}Edit{% else %}Create New{% endif %} Search Filter - {{ block.super }}{% endblock %}

{% block page_title %}{% if form.instance.pk %}Edit{% else %}Create New{% endif %} Search Filter{% endblock %}

{% block breadcrumbs %}
    <li class="breadcrumb-item"><a href="{% url 'dashboard:filter-list' %}">Search Filters</a></li>
    <li class="breadcrumb-item active" aria-current="page">{% if form.instance.pk %}Edit{% else %}New{% endif %}</li>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" />
<style>
.select2-container--bootstrap-5 .select2-selection--multiple .select2-selection__rendered {
    display: flex;
    flex-wrap: wrap;
    gap: 0.25rem;
    padding: 0.375rem 0.75rem;
}

.select2-container--bootstrap-5 .select2-selection--multiple .select2-selection__choice {
    display: flex;
    align-items: center;
    background-color: #e9ecef;
    border: 1px solid #dee2e6;
    border-radius: 0.25rem;
    padding: 0.25rem 0.5rem;
    margin: 0;
}

.select2-container--bootstrap-5 .select2-selection--multiple .select2-search__field {
    min-width: 150px;
}

.select2-container--bootstrap-5 .select2-selection--multiple .select2-selection__choice__remove {
    color: #6c757d;
    margin-right: 0.25rem;
    border: none;
    background: none;
    padding: 0;
    cursor: pointer;
}

.select2-container--bootstrap-5 .select2-selection--multiple .select2-selection__choice__remove:hover {
    color: #dc3545;
}

/* Custom switch styling */
.form-switch .form-check-input {
    width: 2.5em;
    margin-left: -2.7em;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='-4 -4 8 8'%3e%3ccircle r='3' fill='rgba%280, 0, 0, 0.25%29'/%3e%3c/svg%3e");
}

.form-switch .form-check-input:checked {
    background-color: #0d6efd;
    border-color: #0d6efd;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='-4 -4 8 8'%3e%3ccircle r='3' fill='%23fff'/%3e%3c/svg%3e");
}

/* Card styling for form sections */
.card {
    border: 1px solid rgba(0, 0, 0, 0.125);
    border-radius: 0.5rem;
    overflow: hidden;
}

.card-header {
    background-color: #f8f9fa;
    border-bottom: 1px solid rgba(0, 0, 0, 0.125);
    padding: 0.75rem 1.25rem;
}

.card-body {
    padding: 1.25rem;
}

/* Preview section styling */
#filterPreview {
    position: sticky;
    top: 1rem;
}

.preview-item {
    padding: 0.5rem 0;
    border-bottom: 1px solid #eee;
}

.preview-item:last-child {
    border-bottom: none;
}

.preview-label {
    font-weight: 600;
    color: #6c757d;
    margin-bottom: 0.25rem;
}

.preview-value {
    word-break: break-word;
}

/* Responsive adjustments */
@media (max-width: 767.98px) {
    #filterPreview {
        position: static;
        margin-top: 2rem;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8">
        <form method="post" id="searchFilterForm" class="needs-validation" novalidate>
            {% csrf_token %}
            
            <!-- Basic Information Card -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Basic Information</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-8">
                            {{ form.name|as_crispy_field }}
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="form-label">Active</label>
                                <div class="form-check form-switch">
                                    {{ form.is_active }}
                                    <label class="form-check-label" for="{{ form.is_active.id_for_label }}">
                                        {% if form.is_active.value %}
                                            This filter is active
                                        {% else %}
                                            This filter is inactive
                                        {% endif %}
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    {{ form.description|as_crispy_field }}
                </div>
            </div>

            <!-- Search Criteria Card -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Search Criteria</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            {{ form.keywords|as_crispy_field }}
                            <small class="form-text text-muted">
                                Separate multiple keywords with commas. Use quotes for exact phrases.
                            </small>
                        </div>
                        <div class="col-md-6">
                            {{ form.exclude_keywords|as_crispy_field }}
                            <small class="form-text text-muted">
                                Exclude jobs containing these words.
                            </small>
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-md-6">
                            {{ form.location|as_crispy_field }}
                            <small class="form-text text-muted">
                                City, state, or remote
                            </small>
                        </div>
                        <div class="col-md-6">
                            {{ form.radius|as_crispy_field }}
                            <small class="form-text text-muted">
                                Search radius in miles (applies to location)
                            </small>
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-md-6">
                            {{ form.market|as_crispy_field }}
                        </div>
                        <div class="col-md-6">
                            {{ form.job_type|as_crispy_field }}
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">Job Category</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="is_technical" 
                                           id="is_technical_true" value="true" 
                                           {% if form.is_technical.value == True %}checked{% endif %}>
                                    <label class="form-check-label" for="is_technical_true">
                                        Technical Roles
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="is_technical" 
                                           id="is_technical_false" value="false"
                                           {% if form.is_technical.value == False %}checked{% endif %}>
                                    <label class="form-check-label" for="is_technical_false">
                                        Non-Technical Roles
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="is_technical" 
                                           id="is_technical_none" value="" 
                                           {% if form.is_technical.value == None %}checked{% endif %}>
                                    <label class="form-check-label" for="is_technical_none">
                                        Any Category
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            {{ form.experience_level|as_crispy_field }}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Advanced Options Card -->
            <div class="card mb-4">
                <div class="card-header">
                    <button class="btn btn-link p-0 border-0 bg-transparent text-decoration-none" 
                            type="button" data-bs-toggle="collapse" data-bs-target="#advancedOptions" 
                            aria-expanded="false" aria-controls="advancedOptions">
                        <h5 class="mb-0 d-flex align-items-center">
                            <i class="fas fa-cog me-2"></i> Advanced Options
                            <i class="fas fa-chevron-down ms-2 small"></i>
                        </h5>
                    </button>
                </div>
                <div class="collapse" id="advancedOptions">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                {{ form.salary_min|as_crispy_field }}
                            </div>
                            <div class="col-md-6">
                                {{ form.salary_max|as_crispy_field }}
                            </div>
                        </div>
                        
                        <div class="row mt-3">
                            <div class="col-md-6">
                                {{ form.posted_date|as_crispy_field }}
                            </div>
                            <div class="col-md-6">
                                {{ form.employment_type|as_crispy_field }}
                            </div>
                        </div>
                        
                        <div class="row mt-3">
                            <div class="col-12">
                                {{ form.portals|as_crispy_field }}
                                <small class="form-text text-muted">
                                    Select job portals to search (leave empty to search all)
                                </small>
                            </div>
                        </div>
                        
                        <div class="row mt-3">
                            <div class="col-12">
                                <div class="form-check form-switch">
                                    {{ form.include_remote }}
                                    <label class="form-check-label" for="{{ form.include_remote.id_for_label }}">
                                        Include remote jobs
                                    </label>
                                </div>
                                <div class="form-check form-switch">
                                    {{ form.include_relocation }}
                                    <label class="form-check-label" for="{{ form.include_relocation.id_for_label }}">
                                        Include jobs with relocation assistance
                                    </label>
                                </div>
                                <div class="form-check form-switch">
                                    {{ form.include_visa_sponsorship }}
                                    <label class="form-check-label" for="{{ form.include_visa_sponsorship.id_for_label }}">
                                        Include jobs with visa sponsorship
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Scheduling Options Card -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Scheduling</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">Schedule Type</label>
                                <select class="form-select" id="scheduleType" name="schedule_type">
                                    <option value="manual" {% if form.schedule_type.value == 'manual' %}selected{% endif %}>Manual (run when I click)</option>
                                    <option value="daily" {% if form.schedule_type.value == 'daily' %}selected{% endif %}>Daily</option>
                                    <option value="weekly" {% if form.schedule_type.value == 'weekly' %}selected{% endif %}>Weekly</option>
                                    <option value="monthly" {% if form.schedule_type.value == 'monthly' %}selected{% endif %}>Monthly</option>
                                    <option value="custom" {% if form.schedule_type.value == 'custom' %}selected{% endif %}>Custom Schedule</option>
                                </select>
                            </div>
                        </div>
                        <div id="scheduleDayContainer" class="col-md-6" style="display: none;">
                            <div class="form-group">
                                <label class="form-label">Day of Week</label>
                                <select class="form-select" name="schedule_day">
                                    <option value="0" {% if form.schedule_day.value == 0 %}selected{% endif %}>Sunday</option>
                                    <option value="1" {% if form.schedule_day.value == 1 %}selected{% endif %}>Monday</option>
                                    <option value="2" {% if form.schedule_day.value == 2 %}selected{% endif %}>Tuesday</option>
                                    <option value="3" {% if form.schedule_day.value == 3 %}selected{% endif %}>Wednesday</option>
                                    <option value="4" {% if form.schedule_day.value == 4 %}selected{% endif %}>Thursday</option>
                                    <option value="5" {% if form.schedule_day.value == 5 %}selected{% endif %}>Friday</option>
                                    <option value="6" {% if form.schedule_day.value == 6 %}selected{% endif %}>Saturday</option>
                                </select>
                            </div>
                        </div>
                        <div id="scheduleTimeContainer" class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">Time of Day</label>
                                <select class="form-select" name="schedule_time">
                                    {% for hour in "x"|ljust:"24" %}
                                        {% with hour_int=forloop.counter0|stringformat:"02d" %}
                                            <option value="{{ hour_int }}:00" {% if form.schedule_time.value == hour_int|add:":00" %}selected{% endif %}>
                                                {{ hour_int }}:00
                                            </option>
                                            <option value="{{ hour_int }}:30" {% if form.schedule_time.value == hour_int|add:":30" %}selected{% endif %}>
                                                {{ hour_int }}:30
                                            </option>
                                        {% endwith %}
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-12">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="emailNotifications" 
                                       name="email_notifications" {% if form.email_notifications.value %}checked{% endif %}>
                                <label class="form-check-label" for="emailNotifications">
                                    Email me when new jobs are found
                                </label>
                            </div>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="is_default" 
                                       name="is_default" {% if form.is_default.value %}checked{% endif %}>
                                <label class="form-check-label" for="is_default">
                                    Set as default filter
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="d-flex justify-content-between mb-5">
                <a href="{% url 'dashboard:filter-list' %}" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-1"></i> Cancel
                </a>
                <div class="btn-group">
                    <button type="submit" name="save_and_continue" class="btn btn-outline-primary">
                        <i class="fas fa-save me-1"></i> Save & Continue
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-check me-1"></i> Save Filter
                    </button>
                </div>
            </div>
        </form>
    </div>
    
    <!-- Preview Panel -->
    <div class="col-lg-4">
        <div class="card" id="filterPreview">
            <div class="card-header">
                <h5 class="mb-0">Filter Preview</h5>
            </div>
            <div class="card-body">
                <div class="preview-item">
                    <div class="preview-label">Filter Name</div>
                    <div class="preview-value" id="previewName">{% if form.instance.name %}{{ form.instance.name }}{% else %}New Search Filter{% endif %}</div>
                </div>
                
                <div class="preview-item">
                    <div class="preview-label">Status</div>
                    <div class="preview-value">
                        <span class="badge bg-{% if form.instance.is_active %}success{% else %}secondary{% endif %}" id="previewStatus">
                            {% if form.instance.is_active %}Active{% else %}Inactive{% endif %}
                        </span>
                    </div>
                </div>
                
                <div class="preview-item">
                    <div class="preview-label">Keywords</div>
                    <div class="preview-value" id="previewKeywords">
                        {% if form.instance.keywords %}{{ form.instance.keywords }}{% else %}Not specified{% endif %}
                    </div>
                </div>
                
                <div class="preview-item">
                    <div class="preview-label">Location</div>
                    <div class="preview-value" id="previewLocation">
                        {% if form.instance.location %}
                            {{ form.instance.location }}{% if form.instance.radius %} (within {{ form.instance.radius }} miles){% endif %}
                        {% else %}
                            Any location
                        {% endif %}
                    </div>
                </div>
                
                <div class="preview-item">
                    <div class="preview-label">Job Type</div>
                    <div class="preview-value" id="previewJobType">
                        {{ form.instance.get_job_type_display|default:"Any type" }}
                    </div>
                </div>
                
                <div class="preview-item">
                    <div class="preview-label">Category</div>
                    <div class="preview-value" id="previewCategory">
                        {% if form.instance.is_technical is not None %}
                            {{ form.instance.is_technical|yesno:"Technical,Non-Technical" }}
                        {% else %}
                            Any category
                        {% endif %}
                    </div>
                </div>
                
                <div class="preview-item">
                    <div class="preview-label">Schedule</div>
                    <div class="preview-value" id="previewSchedule">
                        {% if form.instance.schedule_type == 'manual' %}
                            Manual (run when clicked)
                        {% elif form.instance.schedule_type %}
                            {{ form.instance.get_schedule_type_display }} at {{ form.instance.schedule_time|default:"12:00" }}
                            {% if form.instance.schedule_type == 'weekly' %}
                                on {{ form.instance.get_schedule_day_display }}
                            {% endif %}
                        {% else %}
                            Not scheduled
                        {% endif %}
                    </div>
                </div>
                
                <div class="preview-item">
                    <div class="preview-label">Last Run</div>
                    <div class="preview-value">
                        {% if form.instance.last_run %}
                            {{ form.instance.last_run|timesince }} ago
                        {% else %}
                            Never
                        {% endif %}
                    </div>
                </div>
                
                <div class="preview-item">
                    <div class="preview-label">Jobs Found</div>
                    <div class="preview-value">
                        {% if form.instance.jobs_found %}
                            {{ form.instance.jobs_found }} jobs
                        {% else %}
                            No jobs found yet
                        {% endif %}
                    </div>
                </div>
                
                <div class="mt-4">
                    <button type="button" class="btn btn-outline-primary w-100" id="testFilterBtn">
                        <i class="fas fa-search me-1"></i> Test This Search
                    </button>
                    {% if form.instance.pk %}
                    <button type="button" class="btn btn-outline-secondary w-100 mt-2" data-bs-toggle="modal" data-bs-target="#runNowModal">
                        <i class="fas fa-play me-1"></i> Run Now
                    </button>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Tips Card -->
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-lightbulb me-2"></i> Tips for Better Searches
                </h5>
            </div>
            <div class="card-body">
                <ul class="list-unstyled">
                    <li class="mb-2">
                        <i class="fas fa-check-circle text-success me-2"></i>
                        <strong>Use specific job titles</strong> for more relevant results
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-check-circle text-success me-2"></i>
                        <strong>Exclude terms</strong> with a minus sign (e.g., -intern -junior)
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-check-circle text-success me-2"></i>
                        <strong>Use quotes</strong> for exact phrases (e.g., "project manager")
                    </li>
                    <li class="mb-2">
                        <i class="fas fa-check-circle text-success me-2"></i>
                        <strong>Try different locations</strong> to find more opportunities
                    </li>
                    <li class="mb-0">
                        <i class="fas fa-check-circle text-success me-2"></i>
                        <strong>Update filters regularly</strong> to stay current with the job market
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Run Now Confirmation Modal -->
<div class="modal fade" id="runNowModal" tabindex="-1" aria-labelledby="runNowModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="runNowModalLabel">Run Search Now</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to run this search now? This will start the scraping process in the background.</p>
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-1"></i>
                    You'll be notified when the search is complete. Large searches may take several minutes.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                <form method="post" action="{% url 'dashboard:filter-run' form.instance.id %}" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-play me-1"></i> Run Now
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Select2 for better select inputs -->
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize Select2
    $('select[multiple]').select2({
        theme: 'bootstrap-5',
        width: '100%',
        placeholder: 'Select options',
        closeOnSelect: false
    });
    
    // Show/hide schedule day based on schedule type
    const scheduleType = document.getElementById('scheduleType');
    const scheduleDayContainer = document.getElementById('scheduleDayContainer');
    
    function updateScheduleDayVisibility() {
        if (scheduleType.value === 'weekly') {
            scheduleDayContainer.style.display = 'block';
        } else {
            scheduleDayContainer.style.display = 'none';
        }
    }
    
    // Initial update
    updateScheduleDayVisibility();
    
    // Update on change
    scheduleType.addEventListener('change', updateScheduleDayVisibility);
    
    // Real-time preview updates
    const form = document.getElementById('searchFilterForm');
    const previewFields = {
        'name': 'previewName',
        'keywords': 'previewKeywords',
        'location': 'previewLocation',
        'job_type': 'previewJobType',
        'is_technical': 'previewCategory',
        'is_active': 'previewStatus',
        'schedule_type': 'previewSchedule',
        'schedule_day': 'previewSchedule',
        'schedule_time': 'previewSchedule'
    };
    
    // Update preview when form fields change
    Object.keys(previewFields).forEach(fieldName => {
        const field = form.querySelector(`[name="${fieldName}"]`);
        if (field) {
            field.addEventListener('change', updatePreview);
            field.addEventListener('input', updatePreview);
        }
    });
    
    // Handle radio buttons for is_technical
    document.querySelectorAll('input[name="is_technical"]').forEach(radio => {
        radio.addEventListener('change', updatePreview);
    });
    
    function updatePreview() {
        // Update name
        const nameField = form.querySelector('[name="name"]');
        if (nameField) {
            document.getElementById('previewName').textContent = nameField.value || 'New Search Filter';
        }
        
        // Update status
        const isActive = form.querySelector('[name="is_active"]');
        if (isActive) {
            const statusBadge = document.getElementById('previewStatus');
            if (isActive.checked) {
                statusBadge.textContent = 'Active';
                statusBadge.className = 'badge bg-success';
            } else {
                statusBadge.textContent = 'Inactive';
                statusBadge.className = 'badge bg-secondary';
            }
        }
        
        // Update keywords
        const keywordsField = form.querySelector('[name="keywords"]');
        if (keywordsField) {
            document.getElementById('previewKeywords').textContent = 
                keywordsField.value || 'Not specified';
        }
        
        // Update location
        const locationField = form.querySelector('[name="location"]');
        const radiusField = form.querySelector('[name="radius"]');
        if (locationField) {
            let locationText = locationField.value || 'Any location';
            if (radiusField && radiusField.value && locationField.value) {
                locationText += ` (within ${radiusField.value} miles)`;
            }
            document.getElementById('previewLocation').textContent = locationText;
        }
        
        // Update job type
        const jobTypeField = form.querySelector('[name="job_type"]');
        if (jobTypeField) {
            const selectedOption = jobTypeField.options[jobTypeField.selectedIndex];
            document.getElementById('previewJobType').textContent = 
                selectedOption.textContent || 'Any type';
        }
        
        // Update category
        const categoryField = document.querySelector('input[name="is_technical"]:checked');
        if (categoryField) {
            let categoryText = 'Any category';
            if (categoryField.value === 'true') {
                categoryText = 'Technical';
            } else if (categoryField.value === 'false') {
                categoryText = 'Non-Technical';
            }
            document.getElementById('previewCategory').textContent = categoryText;
        }
        
        // Update schedule
        updateSchedulePreview();
    }
    
    function updateSchedulePreview() {
        const scheduleType = form.querySelector('[name="schedule_type"]');
        const scheduleDay = form.querySelector('[name="schedule_day"]');
        const scheduleTime = form.querySelector('[name="schedule_time"]');
        
        if (!scheduleType) return;
        
        let scheduleText = 'Not scheduled';
        const selectedType = scheduleType.options[scheduleType.selectedIndex];
        
        if (selectedType.value === 'manual') {
            scheduleText = 'Manual (run when clicked)';
        } else if (selectedType.value === 'weekly' && scheduleDay) {
            const dayOption = scheduleDay.options[scheduleDay.selectedIndex];
            const timeValue = scheduleTime ? scheduleTime.value : '12:00';
            scheduleText = `Weekly on ${dayOption.text} at ${timeValue}`;
        } else if (selectedType.value && scheduleTime) {
            const typeText = selectedType.text;
            const timeValue = scheduleTime.value;
            scheduleText = `${typeText} at ${timeValue}`;
        }
        
        document.getElementById('previewSchedule').textContent = scheduleText;
    }
    
    // Initial preview update
    updatePreview();
    
    // Test filter button
    const testFilterBtn = document.getElementById('testFilterBtn');
    if (testFilterBtn) {
        testFilterBtn.addEventListener('click', function() {
            // Collect form data
            const formData = new FormData(form);
            const params = new URLSearchParams();
            
            // Add relevant fields to the URL
            if (formData.get('keywords')) params.append('q', formData.get('keywords'));
            if (formData.get('location')) params.append('location', formData.get('location'));
            if (formData.get('job_type')) params.append('job_type', formData.get('job_type'));
            if (formData.get('is_technical') !== '') {
                params.append('is_technical', formData.get('is_technical'));
            }
            
            // Redirect to job list with filter parameters
            window.location.href = `{% url 'dashboard:job-list' %}?${params.toString()}`;
        });
    }
    
    // Form validation
    (function () {
        'use strict'
        
        // Fetch all the forms we want to apply custom Bootstrap validation styles to
        var forms = document.querySelectorAll('.needs-validation')
        
        // Loop over them and prevent submission
        Array.prototype.slice.call(forms)
            .forEach(function (form) {
                form.addEventListener('submit', function (event) {
                    if (!form.checkValidity()) {
                        event.preventDefault()
                        event.stopPropagation()
                    }
                    
                    form.classList.add('was-validated')
                }, false)
            })
    })()
});
</script>
{% endblock %}
